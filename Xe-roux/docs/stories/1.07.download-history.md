<!-- Powered by BMAD™ Core -->

# Story 1.07: Download History & "My Clips" Page

**Status:** Done  
**Epic:** 1 – Core Backend Service  
**Created:** 2025-10-16  
**Author:** PO Agent

---

## Story
**As a** returning user of ClipX,  
**I want** to see a list of my recently generated clips (with status & links),  
**so that** I can easily re-download or resume processing without re-pasting URLs.

---

## Acceptance Criteria
1. Backend provides `GET /history` endpoint returning JSON list of last N (default 25) downloads for the requester.
2. History keyed by anonymous session cookie (`CLIPX_SESSION`) with fallback to client IP when cookie missing.
3. Each history item includes: `id`, `source_url`, `state` (queued | processing | done | failed | expired), `created_at`, `finished_at`, and `download_url` (if available).
4. Items auto-expire after 24 h or when cleanup process deletes the file (Story 1.05).
5. Frontend adds "My Clips" tab showing history table, auto-refreshing every 5 s while any item still "processing".
6. Clicking a row with `state=done` triggers browser download from `download_url`.
7. UI gracefully handles empty history (“No clips yet”) and failures.
8. Unit tests for data model, persistence, and API; e2e test via Playwright confirms table updates and download link.

---

## Tasks / Subtasks
- **Backend**
  - [ ] Add lightweight SQLite DB via SQLModel to persist history (or Redis Hash if preferred; document choice).
  - [ ] Create `models/history.py` with `ClipHistory` model.
  - [ ] On task enqueue, insert new row; update `state`/`finished_at` on completion/failure.
  - [ ] Implement `/history` router with filtering by session cookie.
  - [ ] Migrate `/download` to accept `clip_id` parameter and validate ownership.
  - [ ] Add Alembic migration or simple auto-create for SQLite.

- **Frontend**
  - [ ] Create `Pages/MyClips.tsx` route with table component.
  - [ ] Implement `useHistory()` hook calling `/history` and polling.
  - [ ] Add navigation link “My Clips” in header.
  - [ ] Integrate session cookie logic (set on first visit).
  - [ ] Unit tests for hook & component using MSW.

- **DevOps & Docs**
  - [ ] Mount SQLite file to Docker volume; update `docker-compose.yml`.
  - [ ] Document session behaviour & privacy implications in README.
  - [ ] Update OpenAPI spec with `/history`.

---

## Dev Notes
- For anonymous sessions, generate UUID v4 cookie; secure & SameSite=Lax.
- Consider TTL index if Redis chosen.
- Persist only URL hash, not full URL, if privacy required.

---

## Testing Standards
- Backend pytest with SQLite in-memory DB.
- Frontend Playwright test covers end-to-end: paste URL → history item appears → completes → click to download.
- Coverage ≥ 80 %.

---

## Change Log
| Date       | Version | Description                        | Author     |
|------------|---------|------------------------------------|------------|
| 2025-10-16 | 1.0     | Initial story created              | PO Agent   |

---

## Dev Agent Record
*Populated by dev agent during implementation.*

### Agent Model Used
*

### Debug Log References
*

### Completion Notes
*

### File List
*