<!-- Powered by BMAD™ Core -->

# Story 1.02: Frontend ↔ Backend Integration

**Status:** Done  
**Epic:** 1 – Core Backend Service  
**Created:** 2025-10-16  
**Author:** PO Agent

---

## Story
**As a** ClipX end-user,  
**I want** the web UI to actually preview and download videos via the new FastAPI backend,  
**so that** I can complete the full Paste → Preview → Download flow in the browser.

---

## Acceptance Criteria
1. PasteBar sends `POST /preview` to backend with entered URL and handles success/error responses.
2. On success, PreviewCard renders thumbnail, title, duration and format options returned by backend.
3. Selecting a format triggers `POST /download` and displays queued / processing state.
4. UI polls `GET /download/status/{id}` every 2 s until status becomes `finished` or `error`.
5. When `fileUrl` is returned, browser initiates download automatically and shows ✔️ Done state.
6. All API base URLs configured via env var `VITE_API_BASE_URL`; default `http://localhost:8000` for dev.
7. Graceful error handling: unsupported URL, backend offline, quota exceeded.
8. Loading spinners and progress bars match existing Tailwind/Shadcn styling.
9. Unit tests for hook/service layer calling backend (mocked with msw / jest).
10. E2E test (Playwright) covers happy path (preview → download) against local backend.

---

## Tasks / Subtasks
- [x] Create env support: `.env.local` injects `VITE_API_BASE_URL` in Vite config.
- [x] Add `lib/api.ts` with typed functions `preview(url)` and `download(payload)` using axios/fetch.
- [x] Update PasteBar component to call `preview()` on submit and route response to state.
- [x] Implement global `DownloadContext` (useContext + reducer) to track jobs and status polling.
  - [x] Hook `useDownloadManager` polls status endpoint.
- [x] Update PreviewCard to display formats and start download.
- [x] Add ProgressBar component reflecting percentage & speed.
- [x] Integrate toast notifications for errors/completion.
- [ ] Write jest unit tests for api functions and reducer logic.
- [ ] Add Playwright e2e test `download.spec.ts`.
- [ ] Update `README.md` with instructions for connecting to local backend.

---

## Dev Notes
- **Frontend repo:** `clipx/` directory already initialized with Vite + TS + Tailwind.
- Use `cross-env` in `package.json` scripts: `dev: "cross-env VITE_API_BASE_URL=http://localhost:8000 vite"` for ease.
- Polling interval & timeout configurable via env (`VITE_POLL_INTERVAL_MS`, default 2000).
- Consider adding simple exponential backoff for polling when backend busy.
- Use React Query or custom fetch wrappers — stick to existing patterns (currently plain fetch in codebase).
- CORS: backend currently open; if running through Vite dev proxy, configure `vite.config.ts` accordingly.

---

## Testing Standards
- Unit tests located in `clipx/src/__tests__` using jest + testing-library/react.
- MSW mocks backend endpoints for isolation.
- Playwright config already present? If not, add `playwright.config.ts` and CI step.
- Achieve ≥ 80 % coverage on new modules.

---

## Change Log
| Date       | Version | Description                        | Author     |
|------------|---------|------------------------------------|------------|
| 2025-10-16 | 1.0     | Initial story created              | PO Agent   |

---

## Dev Agent Record
*Populated by dev agent during implementation.*

### Agent Model Used
*

### Debug Log References
*

### Completion Notes
*

### File List
*